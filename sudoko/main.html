<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku 6 - Home</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        * { font-family: 'Poppins', sans-serif; box-sizing: border-box; }
        body { 
            margin: 0; padding: 0; overflow: hidden; 
            background: #090a0f; color: white;
        }

        /* Top Right Icons Styling */
        .top-icons { 
            position: absolute; top: 25px; right: 25px; 
            display: flex; gap: 15px; z-index: 100; 
        }

        .icon {
            display: flex; align-items: center; gap: 10px;
            background: rgba(255, 255, 255, 0.08);
            padding: 10px 20px; border-radius: 30px;
            backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease; cursor: pointer;
        }

        .icon:hover { 
            transform: translateY(-3px); background: rgba(255, 255, 255, 0.15);
        }

        .fa-coins { color: #ffd700; }
        .fa-fire { color: #ff4500; }
        .fa-trophy { color: #00acee; }

        /* Center Content */
        .center-box {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); text-align: center; 
            z-index: 100; width: 90%;
        }

        #playerName {
            font-size: clamp(2rem, 8vw, 3.5rem); 
            margin-bottom: 30px; text-transform: uppercase;
            letter-spacing: 4px; font-weight: 900;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .start-btn { 
            padding: 20px 60px; font-size: 1.3rem; 
            background: linear-gradient(135deg, #0a66c2, #004182); 
            color: white; border: none; border-radius: 50px;
            font-weight: bold; text-transform: uppercase;
            letter-spacing: 2px; cursor: pointer;
            transition: 0.3s; box-shadow: 0 15px 30px rgba(10, 102, 194, 0.4);
        }

        .start-btn:hover { 
            transform: scale(1.05); box-shadow: 0 20px 40px rgba(10, 102, 194, 0.6);
        }

        .logout-btn {
            margin-top: 30px; color: rgba(255,255,255,0.4);
            font-size: 0.8rem; cursor: pointer; text-decoration: underline;
        }

        #bgCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="top-icons">
    <div class="icon" title="Leaderboard" onclick="window.location.href='leaderboard.html'">
        <i class="fa fa-trophy"></i>
        <span style="font-size: 0.8rem; font-weight: bold;">RANKS</span>
    </div>

    <div class="icon" title="Daily Streak">
        <i class="fa fa-fire"></i>
        <span id="streakCount">0</span>
    </div>

    <div class="icon" title="Coins Wallet">
        <i class="fa fa-coins"></i>
        <span id="coinCount">0</span>
    </div>
</div>

<div class="center-box">
    <h2 id="playerName">WELCOME PLAYER</h2>
    <button class="start-btn" onclick="window.location.href='game.html'">
        <i class="fa fa-play"></i> Start Game
    </button>
    <div class="logout-btn" onclick="logout()">Logout / Switch Account</div>
</div>

<script src="motion.js"></script>

<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = { 
    databaseURL: "https://sudokugame6x6-default-rtdb.firebaseio.com/" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------- LOGIN PROTECTION ---------- */
const gamerName = localStorage.getItem("gamerName");
if (!gamerName) {
    window.location.href = 'login.html';
}

/* ---------- STREAK LOGIC ---------- */
function updateStreak() {
    const today = new Date().toDateString();
    const lastPlayed = localStorage.getItem("lastPlayed");
    let currentStreak = parseInt(localStorage.getItem("streak")) || 0;

    if (lastPlayed !== today) {
        if (lastPlayed) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (lastPlayed === yesterday.toDateString()) {
                currentStreak++; // Played yesterday, increase streak
            } else {
                currentStreak = 1; // Missed a day, reset to 1
            }
        } else {
            currentStreak = 1; // New User first play, starts at 1
        }
        
        localStorage.setItem("streak", currentStreak);
        localStorage.setItem("lastPlayed", today);
        
        // Sync streak to Firebase
        db.ref('players/' + gamerName).update({ streak: currentStreak });
    }
}

/* ---------- REFRESH UI DATA ---------- */
function refreshData() {
    // Get latest coins from Firebase to ensure accuracy
    db.ref('players/' + gamerName).once('value', (snapshot) => {
        if (snapshot.exists()) {
            const data = snapshot.val();
            const coins = data.coins || 0;
            const streak = data.streak || 0;

            // Update LocalStorage and UI
            localStorage.setItem("coins", coins);
            localStorage.setItem("streak", streak);

            document.getElementById("coinCount").innerText = coins;
            document.getElementById("streakCount").innerText = streak;
            document.getElementById("playerName").innerText = "WELCOME " + gamerName;
        }
    });
}

function logout() {
    localStorage.clear();
    window.location.href = 'login.html';
}

/* ---------- EXECUTE ---------- */
updateStreak();
refreshData();

// Refresh if user hits "Back" button
window.onpageshow = function(event) {
    refreshData();
};
</script>

</body>
</html>