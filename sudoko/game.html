<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku 6 - Premium Play</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }

        body { 
            margin: 0;
            overflow: hidden;
            background: #090a0f; 
            font-family: -apple-system, sans-serif;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #bgCanvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        /* The Centered Game Card with Glassmorphism */
        .game-card {
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(20px) saturate(160%);
            -webkit-backdrop-filter: blur(20px) saturate(160%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 32px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            width: 95%;
            max-width: 420px;
            padding: 24px;
        }

        /* Board Styling */
        .sudoku-grid {
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid #111;
            border-radius: 8px;
            overflow: hidden;
        }

        .thick-r { border-right: 4px solid #111 !important; }
        .thick-b { border-bottom: 4px solid #111 !important; }

        /* Animations */
        .blink-green { animation: g-flash 0.8s ease-in-out forwards !important; }
        .blink-red { animation: r-flash 0.5s ease-in-out forwards !important; }
        @keyframes g-flash { 0%, 100% { background: white; } 50% { background: #057642; color: white; } }
        @keyframes r-flash { 0%, 100% { background: white; } 50% { background: #d11124; color: white; } }

        .cell-selected { background: #0a66c2 !important; color: white !important; z-index: 20; }
        .related-bg { background-color: rgba(10, 102, 194, 0.1); }

        /* UI Elements */
        .premium-stat {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            color: white;
        }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div x-data="sudokuPro()" x-init="initGame()" class="game-card" x-cloak>
    
    <div class="flex justify-between items-center mb-6">
        <button @click="window.location.href='main.html'" class="text-white font-bold text-sm hover:text-blue-400 transition-colors">
            ‚Üê EXIT
        </button>
        <div class="premium-stat px-4 py-1.5 text-center">
            <p class="text-[9px] font-bold uppercase tracking-widest opacity-70">Balance</p>
            <div class="flex items-center gap-1 font-bold text-lg">
                <span x-text="coins"></span><span class="text-yellow-400">ü™ô</span>
            </div>
        </div>
    </div>

    <div class="sudoku-grid grid grid-cols-6 mb-6">
        <template x-for="(cell, i) in grid" :key="i">
            <div @click="selectedIndex = i"
                :class="{
                    'h-14 sm:h-16 flex items-center justify-center text-xl cursor-pointer border border-gray-200': true,
                    'thick-r': (i + 1) % 3 === 0 && (i + 1) % 6 !== 0,
                    'thick-b': Math.floor(i / 6) === 1 || Math.floor(i / 6) === 3,
                    'cell-selected': selectedIndex === i,
                    'related-bg': isRelated(i) && selectedIndex !== i,
                    'blink-green': cell.blinkingGreen,
                    'blink-red': cell.blinkingRed,
                    'font-bold text-gray-900': cell.fixed,
                    'text-blue-600': !cell.fixed && cell.value !== 0
                }" x-text="cell.value !== 0 ? cell.value : ''"></div>
        </template>
    </div>

    <div class="grid grid-cols-6 gap-2 mb-6">
        <template x-for="n in 6">
            <button @click="inputNum(n)" 
                class="bg-white/90 hover:bg-white py-3 rounded-xl font-bold text-xl transition-all active:scale-95 text-gray-800" x-text="n"></button>
        </template>
    </div>

    <div class="flex gap-3">
        <button @click="useHint()" :disabled="coins < 1" 
            class="flex-1 bg-blue-600 text-white py-3.5 rounded-full font-bold shadow-lg hover:bg-blue-500 disabled:opacity-50 transition-all">
            üí° HINT
        </button>
        <button @click="deleteCell()" 
            class="flex-1 bg-white/20 text-white py-3.5 rounded-full font-bold hover:bg-white/30 transition-all">
            DELETE
        </button>
    </div>

    <div x-show="won" class="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-6 z-50">
        <div class="bg-white p-8 rounded-3xl text-center shadow-2xl max-w-xs w-full">
            <h2 class="text-3xl font-black mb-2 text-gray-800">VICTORY!</h2>
            <p class="text-green-600 font-bold mb-6">+10 Coins Earned</p>
            <button @click="nextLevel()" class="w-full bg-blue-600 text-white py-4 rounded-full font-bold text-lg hover:bg-blue-700">NEXT STAGE</button>
        </div>
    </div>
</div>

<script src="motion.js"></script>
<script>
function sudokuPro() {
    return {
        grid: [], solution: [], selectedIndex: null, level: 1, 
        coins: parseInt(localStorage.getItem("coins")) || 50, won: false,
        initGame() { this.generateLevel(); },
        saveData() { localStorage.setItem("coins", this.coins.toString()); },
        isRelated(i) {
            if (this.selectedIndex === null) return false;
            let r1 = Math.floor(this.selectedIndex / 6), c1 = this.selectedIndex % 6;
            let r2 = Math.floor(i / 6), c2 = i % 6;
            return r1 === r2 || c1 === c2;
        },
        generateLevel() {
            let b = Array(36).fill(0);
            this.solveSudoku(b);
            this.solution = [...b];
            let clues = 16; 
            this.grid = b.map(v => ({ value: Math.random() > clues/36 ? 0 : v, fixed: false, blinkingGreen: false, blinkingRed: false }));
            this.grid.forEach(c => { if(c.value !== 0) c.fixed = true; });
            this.won = false;
        },
        inputNum(n) {
            if (this.selectedIndex === null || this.grid[this.selectedIndex].fixed) return;
            let cell = this.grid[this.selectedIndex];
            if (n === this.solution[this.selectedIndex]) {
                cell.value = n;
                this.checkBlinks(this.selectedIndex);
                if (this.grid.every((c, i) => c.value === this.solution[i])) {
                    setTimeout(() => { this.coins += 10; this.saveData(); this.won = true; }, 800);
                }
            } else {
                cell.value = n;
                cell.blinkingRed = true;
                setTimeout(() => { cell.blinkingRed = false; cell.value = 0; }, 500);
            }
        },
        useHint() {
            if (this.coins < 1) return;
            let idx = this.grid.findIndex((c, i) => c.value !== this.solution[i]);
            if (idx !== -1) {
                this.coins -= 1; this.saveData();
                this.grid[idx].value = this.solution[idx];
                this.grid[idx].fixed = true;
                this.checkBlinks(idx);
                if (this.grid.every((c, i) => c.value === this.solution[i])) {
                    setTimeout(() => { this.coins += 10; this.saveData(); this.won = true; }, 800);
                }
            }
        },
        checkBlinks(idx) {
            const r = Math.floor(idx/6), c = idx%6, bR = Math.floor(r/2), bC = Math.floor(c/3);
            if (this.grid.slice(r*6, r*6+6).every((cell, i) => cell.value === this.solution[r*6+i])) this.triggerBlink(i => Math.floor(i/6) === r);
            let colV = true; for(let i=0; i<6; i++) if(this.grid[i*6+c].value !== this.solution[i*6+c]) colV = false;
            if(colV) this.triggerBlink(i => i%6 === c);
            let boxV = true, bIdx = [];
            for(let i=0; i<2; i++) for(let j=0; j<3; j++) {
                let curr = (bR*2+i)*6 + (bC*3+j); bIdx.push(curr);
                if(this.grid[curr].value !== this.solution[curr]) boxV = false;
            }
            if(boxV) this.triggerBlink(i => bIdx.includes(i));
        },
        triggerBlink(condition) {
            this.grid.forEach((cell, i) => {
                if(condition(i)) {
                    cell.blinkingGreen = true;
                    setTimeout(() => { cell.blinkingGreen = false; }, 800);
                }
            });
        },
        deleteCell() { if(this.selectedIndex !== null && !this.grid[this.selectedIndex].fixed) this.grid[this.selectedIndex].value = 0; },
        nextLevel() { this.level++; this.generateLevel(); },
        solveSudoku(b) {
            for (let i = 0; i < 36; i++) {
                if (b[i] === 0) {
                    let ns = [1,2,3,4,5,6].sort(() => Math.random()-0.5);
                    for (let n of ns) { if (this.isValid(b, i, n)) { b[i] = n; if (this.solveSudoku(b)) return true; b[i] = 0; } }
                    return false;
                }
            }
            return true;
        },
        isValid(b, idx, n) {
            let r = Math.floor(idx/6), c = idx%6;
            for (let i=0; i<6; i++) if (b[r*6+i]===n || b[i*6+c]===n) return false;
            let br = Math.floor(r/2)*2, bc = Math.floor(c/3)*3;
            for (let i=0; i<2; i++) for (let j=0; j<3; j++) if (b[(br+i)*6+(bc+j)]===n) return false;
            return true;
        }
    }
}
</script>
</body>
</html>